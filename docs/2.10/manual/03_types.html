<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Spyne Models and Native Python Types &mdash; spyne 2.11.0 documentation</title>
    
    <link rel="stylesheet" href="../static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.11.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="spyne 2.11.0 documentation" href="../index.html" />
    <link rel="up" title="Spyne Manual" href="index.html" />
    <link rel="next" title="User Manager" href="04_usermanager.html" />
    <link rel="prev" title="Hello World" href="02_helloworld.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="04_usermanager.html" title="User Manager"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="02_helloworld.html" title="Hello World"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">spyne 2.11.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Spyne Manual</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Spyne Models and Native Python Types</a><ul>
<li><a class="reference internal" href="#customization">Customization</a></li>
<li><a class="reference internal" href="#primitives">Primitives</a><ul>
<li><a class="reference internal" href="#numbers">Numbers</a></li>
<li><a class="reference internal" href="#strings">Strings</a></li>
<li><a class="reference internal" href="#date-time-types">Date/Time Types</a></li>
<li><a class="reference internal" href="#spatial-types">Spatial Types</a></li>
<li><a class="reference internal" href="#miscellanous-types">Miscellanous Types</a></li>
<li><a class="reference internal" href="#dynamic-types">Dynamic Types</a></li>
<li><a class="reference internal" href="#mandatory-variants">Mandatory Variants</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enum">Enum</a></li>
<li><a class="reference internal" href="#binary">Binary</a></li>
<li><a class="reference internal" href="#complex">Complex</a><ul>
<li><a class="reference internal" href="#arrays">Arrays</a></li>
<li><a class="reference internal" href="#complex-models-as-return-values">Complex Models as Return Values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fault">Fault</a></li>
<li><a class="reference internal" href="#what-s-next">What&#8217;s next?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="02_helloworld.html"
                        title="previous chapter">Hello World</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="04_usermanager.html"
                        title="next chapter">User Manager</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/manual/03_types.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="spyne-models-and-native-python-types">
<span id="manual-types"></span><h1>Spyne Models and Native Python Types<a class="headerlink" href="#spyne-models-and-native-python-types" title="Permalink to this headline">¶</a></h1>
<p>There are five types of models in Spyne:</p>
<ul class="simple">
<li><strong>Primitive:</strong> These are basic models that can contain a single value at a
time. Primitive types are more-or-less present in any programming language
and all of them map to a well-defined Python type. Types like <tt class="docutils literal"><span class="pre">Integer</span></tt>,
<tt class="docutils literal"><span class="pre">Decimal</span></tt>, <tt class="docutils literal"><span class="pre">Float</span></tt>, <tt class="docutils literal"><span class="pre">String</span></tt>, <tt class="docutils literal"><span class="pre">Date</span></tt> are all primitives. See the
documentation for <a class="reference internal" href="../reference/model/primitive.html#module-spyne.model.primitive" title="spyne.model.primitive"><tt class="xref py py-mod docutils literal"><span class="pre">spyne.model.primitive</span></tt></a> for more info.</li>
<li><strong>Enum:</strong> Custom types that can take only a pre-determined number of values.
It&#8217;s also possible to get enum-like behavior with primitives as well. Enums
are defined using the <a class="reference internal" href="../reference/model/enum.html#spyne.model.enum.Enum" title="spyne.model.enum.Enum"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.enum.Enum</span></tt></a> class.</li>
<li><strong>Binary:</strong> Binary types are used to represent arbitrarily-long byte streams.
There are two binary types in Spyne: The
<a class="reference internal" href="../reference/model/binary.html#spyne.model.binary.ByteArray" title="spyne.model.binary.ByteArray"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.binary.ByteArray</span></tt></a> and the
<a class="reference internal" href="../reference/model/binary.html#spyne.model.binary.File" title="spyne.model.binary.File"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.binary.File</span></tt></a> class. While any sequence of <tt class="docutils literal"><span class="pre">str</span></tt>
instances can be used as <tt class="docutils literal"><span class="pre">ByteArray</span></tt>, the <tt class="docutils literal"><span class="pre">File</span></tt> only works with a
<tt class="docutils literal"><span class="pre">File.Value</span></tt> instance. Please see the relevant example below for a more
thorough explanation.</li>
<li><strong>Complex:</strong> Complex objects are subclasses of the
<a class="reference internal" href="../reference/model/complex.html#spyne.model.complex.ComplexModel" title="spyne.model.complex.ComplexModel"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.complex.ComplexModel</span></tt></a> class. They are hierarchical
container classes that can contain any type of object. Two well known
examples are the
<a class="reference internal" href="../reference/model/complex.html#spyne.model.complex.Array" title="spyne.model.complex.Array"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.complex.Array</span></tt></a> and
<a class="reference internal" href="../reference/model/complex.html#spyne.model.complex.Iterable" title="spyne.model.complex.Iterable"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.complex.Iterable</span></tt></a> types.
They are just specialized complex objects.</li>
<li><strong>Fault:</strong> When an exception is thrown from the user code, it&#8217;s serialized
and returned to the client as a <a class="reference internal" href="../reference/model/fault.html#spyne.model.fault.Fault" title="spyne.model.fault.Fault"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.fault.Fault</span></tt></a>. If it is
not a subclass of <tt class="docutils literal"><span class="pre">Fault</span></tt>, the client will probably see this
as an internal error. Some of the most common exceptions that a web service
might need to throw can be found in the <a class="reference internal" href="../reference/error.html#module-spyne.error" title="spyne.error"><tt class="xref py py-mod docutils literal"><span class="pre">spyne.error</span></tt></a> module.</li>
</ul>
<p>Before going into detail about each category of models, we will first talk
about an operation that applies to all models: Type Customization.</p>
<div class="section" id="customization">
<h2>Customization<a class="headerlink" href="#customization" title="Permalink to this headline">¶</a></h2>
<p>Model customization is how one adds declarative restrictions and other metadata
to a Spyne model. This model metadata is stored in a generic object called
<tt class="docutils literal"><span class="pre">Attributes</span></tt>. Every Spyne model has this object as a class attribute.</p>
<p>As an example, let&#8217;s customize the vanilla <tt class="docutils literal"><span class="pre">Unicode</span></tt> type to accept only
valid email strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EmailString</span><span class="p">(</span><span class="n">Unicode</span><span class="p">):</span>
    <span class="n">__type_name__</span> <span class="o">=</span> <span class="s">&#39;EmailString&#39;</span>

    <span class="k">class</span> <span class="nc">Attributes</span><span class="p">(</span><span class="n">Unicode</span><span class="o">.</span><span class="n">Attributes</span><span class="p">):</span>
        <span class="n">max_length</span> <span class="o">=</span> <span class="mi">128</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;[^@]+@[^@]+&#39;</span>
</pre></div>
</div>
<p>You must consult the reference of the type you want to customize in order to
learn about which values it supports for its <tt class="docutils literal"><span class="pre">Attributes</span></tt> object.</p>
<p>As this is a quite verbose way of doing it, Spyne offers an in-line
customization mechanism for every type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">EmailString</span> <span class="o">=</span> <span class="n">Unicode</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;[^@]+@[^@]+&#39;</span><span class="p">,</span>
        <span class="n">type_name</span><span class="o">=</span><span class="s">&#39;EmailString&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Here, <tt class="docutils literal"><span class="pre">type_name</span></tt> is a special argument name that gets assigned to
<tt class="docutils literal"><span class="pre">__type_name__</span></tt> instead of the <tt class="docutils literal"><span class="pre">Attributes</span></tt> class.</p>
<p>Calling simple types directly is a shortcut to their customize method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">EmailString</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;[^@]+@[^@]+&#39;</span><span class="p">,</span>
        <span class="n">type_name</span><span class="o">=</span><span class="s">&#39;EmailString&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>As restricting the length of a string is very common (not all types have such
shortcuts), the length limit can be passed as a positional argument as well:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">EmailString</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;[^@]+@[^@]+&#39;</span><span class="p">,</span>
        <span class="n">type_name</span><span class="o">=</span><span class="s">&#39;EmailString&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>It&#8217;s actually also not strictly necessary (yet highly recommended) to pass a
type name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">EmailString</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;[^@]+@[^@]+&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When the <tt class="docutils literal"><span class="pre">type_name</span></tt> is omitted, Spyne auto-generates a type name for the
new custom type basing on the class it&#8217;s used in.</p>
<p>Type customizations can also be anonymously tucked inside other class
definitions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">ComplexModel</span><span class="p">):</span>
    <span class="n">user_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;[a-z0-9_-]&#39;</span><span class="p">)</span>
    <span class="n">email_address</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;[^@]+@[^@]+&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Do note that calling <tt class="docutils literal"><span class="pre">ComplexModel</span></tt> subclasses instantitates them. That&#8217;s why
you should use the <tt class="docutils literal"><span class="pre">.customize()</span></tt> call, or plain old subclassing to customize
complex types:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MandatoryUser</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Attributes</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">Attributes</span><span class="p">):</span>
        <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span>
        <span class="n">min_occurs</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">MandatoryUser</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span><span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">min_occurs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="primitives">
<h2>Primitives<a class="headerlink" href="#primitives" title="Permalink to this headline">¶</a></h2>
<p>Using primitives in functions are very simple. Here are some examples:</p>
<div class="highlight-python"><pre>class SomeSampleServices(ServiceBase):
    @srpc(Decimal, Decimal, _returns=Decimal)
    def exp(x, y):
        """Exponentiate arbitrary rationals. A very DoS friendly service!"""
        return x ** y

    utcnow = @srpc(_returns=DateTime)(datetime.utcnow)

    @srpc(Unicode, _returns=Unicode)
    def upper(s):
        return s.upper()

    # etc.</pre>
</div>
<p>Let&#8217;s now look at them group by group:</p>
<div class="section" id="numbers">
<h3>Numbers<a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h3>
<p>Numbers are organized in a hierarchy, with the
<a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Decimal" title="spyne.model.primitive.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Decimal</span></tt></a> type  at the top.
In its vanilla state, the <tt class="docutils literal"><span class="pre">Decimal</span></tt> class is the arbitrary-precision,
arbitrary-size generic number type that will accept just <em>any</em> decimal
number.</p>
<p>It has two direct subclasses: The arbitrary-size
<a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Integer" title="spyne.model.primitive.Integer"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Integer</span></tt></a> type and the machine-dependent
<a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Double" title="spyne.model.primitive.Double"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Double</span></tt></a> (<a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Float" title="spyne.model.primitive.Float"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Float</span></tt></a>
is a synonym for <tt class="docutils literal"><span class="pre">Double</span></tt> as Python does not distinguish between
floats and doubles) types.</p>
<p>Unless you are <em>sure</em> that you need to deal with arbitrary-size numbers you
should not use the arbitrary-size types in their vanilla form.</p>
<p>You must also refrain from using <a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Float" title="spyne.model.primitive.Float"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Float</span></tt></a> and
<a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Double" title="spyne.model.primitive.Double"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Double</span></tt></a> types unless you need your math to
roll faster as their representation is machine-specific, thus not very
reliable nor portable.</p>
<p>For integers, we recommend you to use bounded types like
<a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.UnsignedInteger32" title="spyne.model.primitive.UnsignedInteger32"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.UnsignedInteger32</span></tt></a> which can only contain a
32-bit unsigned integer. (Which is very popular as e.g. a primary key type
in a relational database.)</p>
<p>For floating-point numbers, use the <tt class="docutils literal"><span class="pre">Decimal</span></tt> type with a pre-defined scale
and precision. E.g. <tt class="docutils literal"><span class="pre">Decimal(16,</span> <span class="pre">4)</span></tt> can represent a 16-digit number in total
which can have up to 4 decimal digits, which could be used e.g. as a nice
monetary type. <a class="footnote-reference" href="#id6" id="id1">[1]</a></p>
<p>Note that it is your responsibility to make sure that the scale and precision
constraints are consistent with the values in the context of the decimal
package. See the <a class="reference external" href="http://docs.python.org/library/decimal.html#decimal.getcontext" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">decimal.getcontext()</span></tt></a> documentation for more
information.</p>
<p>It&#8217;s also possible to set range constraints (<tt class="docutils literal"><span class="pre">Decimal(gt=4,</span> <span class="pre">lt=10)</span></tt>) or
discrete values (<tt class="docutils literal"><span class="pre">UnsignedInteger8(values=[2,4,6,8]</span></tt>). Please see the
<a class="reference internal" href="../reference/model/primitive.html#module-spyne.model.primitive" title="spyne.model.primitive"><tt class="xref py py-mod docutils literal"><span class="pre">spyne.model.primitive</span></tt></a> documentation for more details regarding number
handling in Spyne.</p>
</div>
<div class="section" id="strings">
<h3>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h3>
<p>There are two string types in Spyne: <a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Unicode" title="spyne.model.primitive.Unicode"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Unicode</span></tt></a> and
<tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.String</span></tt> whose native types are <tt class="docutils literal"><span class="pre">unicode</span></tt> and
<tt class="docutils literal"><span class="pre">str</span></tt> respectively.</p>
<p>Unlike the Python <tt class="docutils literal"><span class="pre">str</span></tt>, the Spyne <tt class="docutils literal"><span class="pre">String</span></tt> is not for arbitrary byte
streams.
You should not use it unless you are absolutely, positively sure that
you need to deal with text data with an unknown encoding.
In all other cases, you should just use the <tt class="docutils literal"><span class="pre">Unicode</span></tt> type. They actually
look the same from outside, this distinction is made just to properly deal
with the quirks surrounding Python-2&#8217;s <tt class="docutils literal"><span class="pre">unicode</span></tt> type.</p>
<p>Remember that you have the <tt class="docutils literal"><span class="pre">ByteArray</span></tt> and <tt class="docutils literal"><span class="pre">File</span></tt> types at your disposal
when you need to deal with arbitrary byte streams.</p>
<p>The <tt class="docutils literal"><span class="pre">String</span></tt> type will be just an alias for <tt class="docutils literal"><span class="pre">Unicode</span></tt>
once Spyne gets ported to Python 3. It might even be deprecated and removed in
the future, so make sure you are using either <tt class="docutils literal"><span class="pre">Unicode</span></tt> or <tt class="docutils literal"><span class="pre">ByteArray</span></tt> in
your interface definitions.</p>
<p><tt class="docutils literal"><span class="pre">File</span></tt>, <tt class="docutils literal"><span class="pre">ByteArray</span></tt>, <tt class="docutils literal"><span class="pre">Unicode</span></tt> and <tt class="docutils literal"><span class="pre">String</span></tt> are all arbitrary-size in
their vanilla versions. Don&#8217;t forget to customize them with additional
restrictions when implementing public services.</p>
<p>Just like numbers, it&#8217;s also possible to place value-based constraints on
Strings (e.g. <tt class="docutils literal"><span class="pre">String(values=['red',</span> <span class="pre">'green',</span> <span class="pre">'blue'])</span></tt> ) but not lexical
constraints.</p>
<p>See also the configuration parameters of your favorite transport for more
information on request size restriction and other precautions against
potential abuse.</p>
</div>
<div class="section" id="date-time-types">
<h3>Date/Time Types<a class="headerlink" href="#date-time-types" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Date" title="spyne.model.primitive.Date"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Date</span></tt></a>, <a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Time" title="spyne.model.primitive.Time"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Time</span></tt></a> and
<a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.DateTime" title="spyne.model.primitive.DateTime"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.DateTime</span></tt></a> correspond to the native types
<tt class="docutils literal"><span class="pre">datetime.date</span></tt>, <tt class="docutils literal"><span class="pre">datetime.time</span></tt> and <tt class="docutils literal"><span class="pre">datetime.datetime</span></tt> respectively.
Spyne supports working with both offset-naive and offset-aware datetimes.</p>
<p>As long as you return the proper native types, you should be fine.</p>
<p>As a side note, the <a class="reference external" href="http://labix.org/python-dateutil">dateutil</a> package is
mighty useful for dealing with dates, times and timezones. Highly recommended!</p>
</div>
<div class="section" id="spatial-types">
<h3>Spatial Types<a class="headerlink" href="#spatial-types" title="Permalink to this headline">¶</a></h3>
<p>Spyne comes with six basic spatial types that are supported by popular packages
like <a class="reference external" href="http://postgis.refractions.net/">PostGIS</a> and
<a class="reference external" href="`http://toblerity.github.com/shapely/">Shapely</a>.</p>
<p>These are provided as <tt class="docutils literal"><span class="pre">Unicode</span></tt> subclasses that just define proper
constraints to force the incoming string to be compliant with the
<a class="reference external" href="https://en.wikipedia.org/wiki/Well-known_text">Well known text (WKT)</a>
format. Well known binary (WKB) format is not (yet?) supported.</p>
<p>The incoming types are not parsed, but you can use <tt class="docutils literal"><span class="pre">shapely.wkb.loads()</span></tt>
function to convert them to native geometric types.</p>
<p>The spatial types that Spyne suppors are as follows:</p>
<ul class="simple">
<li><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Point" title="spyne.model.primitive.Point"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Point</span></tt></a></li>
<li><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Line" title="spyne.model.primitive.Line"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Line</span></tt></a></li>
<li><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Polygon" title="spyne.model.primitive.Polygon"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Polygon</span></tt></a></li>
</ul>
<p>Also the <tt class="docutils literal"><span class="pre">Multi*</span></tt> variants, which are:</p>
<ul class="simple">
<li><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.MultiPoint" title="spyne.model.primitive.MultiPoint"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.MultiPoint</span></tt></a></li>
<li><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.MultiLine" title="spyne.model.primitive.MultiLine"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.MultiLine</span></tt></a></li>
<li><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.MultiPolygon" title="spyne.model.primitive.MultiPolygon"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.MultiPolygon</span></tt></a></li>
</ul>
</div>
<div class="section" id="miscellanous-types">
<h3>Miscellanous Types<a class="headerlink" href="#miscellanous-types" title="Permalink to this headline">¶</a></h3>
<p>There are types defined for convenience in the Xml Schema standard which are
just convenience types on top of the text types. They are implemented as they
are needed by Spyne users. The following are some of the more notable ones.</p>
<ul>
<li><p class="first"><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Boolean" title="spyne.model.primitive.Boolean"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Boolean</span></tt></a>: Life is simple here: Either <tt class="docutils literal"><span class="pre">True</span></tt>
or <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
</li>
<li><p class="first"><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.AnyUri" title="spyne.model.primitive.AnyUri"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.AnyUri</span></tt></a>: An RFC-2396 &amp; 2732 compiant URI type.
See: <a class="reference external" href="http://www.w3.org/TR/xmlschema-2/#anyURI">http://www.w3.org/TR/xmlschema-2/#anyURI</a></p>
<p><strong>NOT YET VALIDATED BY SOFT VALIDATION!!!</strong> Patches are welcome :)</p>
</li>
<li><p class="first"><a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.Uuid" title="spyne.model.primitive.Uuid"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.Uuid</span></tt></a>: A fancy way of packing a 128-bit
integer.</p>
</li>
</ul>
<p>Please consult the <a class="reference internal" href="../reference/model/primitive.html#module-spyne.model.primitive" title="spyne.model.primitive"><tt class="xref py py-mod docutils literal"><span class="pre">spyne.model.primitive</span></tt></a> documentation for a more
complete list.</p>
</div>
<div class="section" id="dynamic-types">
<h3>Dynamic Types<a class="headerlink" href="#dynamic-types" title="Permalink to this headline">¶</a></h3>
<p>While Spyne is all about putting firm restirictions on your input schema,
it&#8217;s also about flexibility.</p>
<p>That&#8217;s why, while generally discouraged, the user can choose to accept or
return unstructed data using the <a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.AnyDict" title="spyne.model.primitive.AnyDict"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.AnyDict</span></tt></a>, whose
native type is a regular <tt class="docutils literal"><span class="pre">dict</span></tt> and <a class="reference internal" href="../reference/model/primitive.html#spyne.model.primitive.AnyXml" title="spyne.model.primitive.AnyXml"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.primitive.AnyXml</span></tt></a>
whose native type is a
regular <tt class="xref py py-class docutils literal"><span class="pre">lxml.etree.Element</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">AnyDict</span></tt> and <tt class="docutils literal"><span class="pre">AnyXml</span></tt> are roughly equivalent when the underlying
protocol is an XML based one &#8211; <tt class="docutils literal"><span class="pre">AnyDict</span></tt> just totally ignores attributes.</p>
</div>
<div class="section" id="mandatory-variants">
<h3>Mandatory Variants<a class="headerlink" href="#mandatory-variants" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
</div>
<div class="section" id="enum">
<h2>Enum<a class="headerlink" href="#enum" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../reference/model/enum.html#spyne.model.enum.Enum" title="spyne.model.enum.Enum"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.enum.Enum</span></tt></a> type mimics the <tt class="docutils literal"><span class="pre">enum</span></tt> in C/C++ with some
additional type safety. It&#8217;s part of the Spyne&#8217;s SOAP heritage so its being
there is mostly for compatibility reasons. If you want to use it, go right
ahead, it will work. But you can get the same functionality by defining a
custom <tt class="docutils literal"><span class="pre">Unicode</span></tt> type via:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">SomeUnicode</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The equivalent Enum-based declaration would be as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">SomeEnum</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="n">type_name</span><span class="o">=</span><span class="s">&quot;SomeEnum&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>These to would be serialized the same, yet their API is different. Lets look at
the following class definition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">ComplexModel</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">SomeEnum</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">SomeUnicode</span>
</pre></div>
</div>
<p>Assuming the following message comes in:</p>
<div class="highlight-python"><pre>&lt;SomeClass&gt;
  &lt;a&gt;x&lt;/a&gt;
  &lt;b&gt;x&lt;/b&gt;
&lt;/SomeClass&gt;</pre>
</div>
<p>We will have:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">some_class</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="s">&#39;x&#39;</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_class</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="s">&#39;x&#39;</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_class</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="n">SomeEnum</span><span class="o">.</span><span class="n">x</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_class</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="n">SomeEnum</span><span class="o">.</span><span class="n">x</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_class</span><span class="o">.</span><span class="n">b</span> <span class="ow">is</span> <span class="n">SomeEnum</span><span class="o">.</span><span class="n">x</span>
<span class="go">True</span>
</pre></div>
</div>
<p>So <tt class="docutils literal"><span class="pre">Enum</span></tt> is just a fancier value-restricted <tt class="docutils literal"><span class="pre">Unicode</span></tt> that has a
marginally faster (as it doesn&#8217;t do string comparison) comparison option. You
probably don&#8217;t need it.</p>
</div>
<div class="section" id="binary">
<h2>Binary<a class="headerlink" href="#binary" title="Permalink to this headline">¶</a></h2>
<p>Dealing with binary data has traditionally been a weak spot of most of the
serialization formats in use today. The best XML or MIME (email) does is
either base64 encoding or something similar, Json has no clue about binary
data (and many other things actually, but let&#8217;s just not go there now) and
SOAP, in all its bloatiness, has quite a few binary encoding options
available, yet none of the &#8220;optimized&#8221; ones are implemented in Spyne <a class="footnote-reference" href="#id7" id="id2">[2]</a>.</p>
<p>Spyne supports binary data on all of the protocols it implements, falling back
to base64 encoding where necessary. In terms of message size, the efficient
protocols are <a class="reference external" href="http://msgpack.org">MessagePack</a> and good old Http. But, as
MessagePack does not offer an incremental parsing/generation API in its Python
wrapper, (in other words, it&#8217;s not possible to parse the message without
having it all in memory) it&#8217;s best to use the
<a class="reference internal" href="../reference/protocol/http.html#spyne.protocol.http.HttpRpc" title="spyne.protocol.http.HttpRpc"><tt class="xref py py-class docutils literal"><span class="pre">spyne.protocol.http.HttpRpc</span></tt></a> protocol when dealing with arbitrary-size
binary data.</p>
<p>A few points to consider:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">HttpRpc</span></tt> only works with a Http transport.</li>
<li><tt class="docutils literal"><span class="pre">HttpRpc</span></tt> supports only one file per request.</li>
<li>Not every http transport supports incremental parsing of incoming data.
(e.g. Twisted). Make sure to test your stack end-to-end to see how it
handles huge messages <a class="footnote-reference" href="#id8" id="id3">[3]</a>.</li>
</ol>
<p>Now that all that is said, let&#8217;s look at the API that Spyne provides for
dealing with binary data.</p>
<p>Spyne offers two types:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="../reference/model/binary.html#spyne.model.binary.ByteArray" title="spyne.model.binary.ByteArray"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.binary.ByteArray</span></tt></a> is a simple type that contains
arbitrary data. It&#8217;s similar to Python&#8217;s own <tt class="docutils literal"><span class="pre">str</span></tt> in terms of
functionality, but it&#8217;s a sequence of <tt class="docutils literal"><span class="pre">str</span></tt> instances instead of just a
big <tt class="docutils literal"><span class="pre">str</span></tt> to be able to handle data in chunks using generators when
needed <a class="footnote-reference" href="#id9" id="id4">[4]</a>.</li>
<li><a class="reference internal" href="../reference/model/binary.html#spyne.model.binary.File" title="spyne.model.binary.File"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.binary.File</span></tt></a> is a quirkier type that is mainly used to
deal with Http way of dealing with file uploads. Its native value is the
<tt class="docutils literal"><span class="pre">File.Value</span></tt> instance in <a class="reference internal" href="../reference/model/binary.html#spyne.model.binary.File" title="spyne.model.binary.File"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.binary.File</span></tt></a>. See its
documentation for more information.</li>
</ol>
<p>Dealing with binary data with Spyne is not that hard &#8211; you just need to make
sure your data is parsed incrementally when you&#8217;re preparing to deal with
arbitrary-size binary data, which means you need to do careful testing as
different WSGI implementations behave differently.</p>
</div>
<div class="section" id="complex">
<h2>Complex<a class="headerlink" href="#complex" title="Permalink to this headline">¶</a></h2>
<p>Types that can contain other types are termed &#8220;complex objects&#8221;. They must be
subclasses of <a class="reference internal" href="../reference/model/complex.html#spyne.model.complex.ComplexModel" title="spyne.model.complex.ComplexModel"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.complex.ComplexModel</span></tt></a> class.</p>
<p>Here&#8217;s a sample complex object definition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Permission</span><span class="p">(</span><span class="n">ComplexModel</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">Unicode</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">Unicode</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">ComplexModel</span></tt> metaclass, namely the
<a class="reference internal" href="../reference/model/complex.html#spyne.model.complex.ComplexModelMeta" title="spyne.model.complex.ComplexModelMeta"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.complex.ComplexModelMeta</span></tt></a> scans the class definition and
ignores</p>
<ol class="arabic simple">
<li>Those that begin with an underscore (<tt class="docutils literal"><span class="pre">_</span></tt>)</li>
<li>Those that are not subclasses of the <tt class="docutils literal"><span class="pre">ModelBase</span></tt>.</li>
</ol>
<p>If you want to use Python keywords as field names, or need leading underscores
in field names, or you just want your Spyne definition and other code to be
separate, you can do away with the metaclass magic and do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Permission</span><span class="p">(</span><span class="n">ComplexModel</span><span class="p">):</span>
    <span class="n">_type_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;application&#39;</span><span class="p">:</span> <span class="n">Unicode</span><span class="p">,</span>
        <span class="s">&#39;feature&#39;</span><span class="p">:</span> <span class="n">Unicode</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>However, you still won&#8217;t get predictable field order, as you&#8217;re just assigning
a <tt class="docutils literal"><span class="pre">dict</span></tt> to the <tt class="docutils literal"><span class="pre">_type_info</span></tt> attribute. If you also need that, (which
becomes handy when you serialize your return value directly to HTML) you need
to pass a sequence of <tt class="docutils literal"><span class="pre">(field_name,</span> <span class="pre">field_type)</span></tt> tuples, like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Permission</span><span class="p">(</span><span class="n">ComplexModel</span><span class="p">):</span>
    <span class="n">_type_info</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">&#39;application&#39;</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;feature&#39;</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>If you want to set some defaults (e.g. namespace) with your objects, you can
define your own <tt class="docutils literal"><span class="pre">CompexModel</span></tt> base class as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyAppComplexModel</span><span class="p">(</span><span class="n">ComplexModelBase</span><span class="p">):</span>
    <span class="n">__namespace__</span> <span class="o">=</span> <span class="s">&quot;http://example.com/myapp&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ComplexModelMeta</span>
</pre></div>
</div>
<div class="section" id="arrays">
<h3>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h3>
<p>If you need to deal with more than one instance of something, the
<a class="reference internal" href="../reference/model/complex.html#spyne.model.complex.Array" title="spyne.model.complex.Array"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.complex.Array</span></tt></a> is what you need.</p>
<p>Imagine the following inside the definition of a <tt class="docutils literal"><span class="pre">User</span></tt> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">permissions</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">Permission</span><span class="p">)</span>
</pre></div>
</div>
<p>The User can have an infinite number of permissions. If you need to put a
limit to that, you can do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">permissions</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">Permission</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span><span class="n">max_occurs</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
</pre></div>
</div>
<p>It is important to emphasize once more that Spyne restrictions are only
enforced for an incoming request when validation is enabled. If you want this
enforcement for <em>every</em> assignment, you do this the usual way by writing a
property setter.</p>
<p>The <tt class="docutils literal"><span class="pre">Array</span></tt> type has two alternatives. The first one is the
<a class="reference internal" href="../reference/model/complex.html#spyne.model.complex.Iterable" title="spyne.model.complex.Iterable"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.complex.Iterable</span></tt></a> type.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">permissions</span> <span class="o">=</span> <span class="n">Iterable</span><span class="p">(</span><span class="n">Permission</span><span class="p">)</span>
</pre></div>
</div>
<p>It is equivalent to the <tt class="docutils literal"><span class="pre">Array</span></tt> type from an interface perspective &#8211;
the client will not notice any difference between an <tt class="docutils literal"><span class="pre">Iterable</span></tt> and an
<tt class="docutils literal"><span class="pre">Array</span></tt> as return type.</p>
<p>It&#8217;s just meant to signal the internediate machinery that the return value
<em>could</em> be a generator and <strong>must not</strong> be consumed unless returning data to
the client. This comes in handy for, e.g. custom loggers because they should
not try to log the return value (as that would mean consuming the generator).</p>
<p>You could use the <tt class="docutils literal"><span class="pre">Iterable</span></tt> marker in other places instead of <tt class="docutils literal"><span class="pre">Array</span></tt>
without any problems, but it&#8217;s really meant to be used as return types in
function definitions.</p>
<p>The second alternative to the <tt class="docutils literal"><span class="pre">Array</span></tt> notation is the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">permissions</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span><span class="n">max_occurs</span><span class="o">=</span><span class="s">&#39;unbounded&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The native value that you should return for both remain the same: a sequence
of the designated type. However, the exposed interface is slightly different
for Xml and friends (other protocols that ship with Spyne always assume the
second notation).</p>
<p>When you use <tt class="docutils literal"><span class="pre">Array</span></tt>, what really happens is that the <tt class="docutils literal"><span class="pre">customize()</span></tt> function
of the array type creates an in-place class that is equivalent to the
following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PermissionArray</span><span class="p">(</span><span class="n">ComplexModel</span><span class="p">):</span>
    <span class="n">Permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span><span class="n">max_occurs</span><span class="o">=</span><span class="s">&#39;unbounded&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Whereas when you just set <tt class="docutils literal"><span class="pre">max_occurs</span></tt> to a value greater than 1, you just get
multiple values without the wrapping object.</p>
<p>As an example, let&#8217;s look at the following array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">v</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Permission</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="s">&#39;app&#39;</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="s">&#39;f1&#39;</span><span class="p">),</span>
    <span class="n">Permission</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="s">&#39;app&#39;</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="s">&#39;f2&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Here&#8217;s how it would be serialized to XML with <tt class="docutils literal"><span class="pre">Array(Permission)</span></tt> as return
type:</p>
<div class="highlight-python"><pre>&lt;PermissionArray&gt;
  &lt;Permission&gt;
    &lt;application&gt;app&lt;/application&gt;
    &lt;feature&gt;f1&lt;/feature&gt;
  &lt;/Permission&gt;
  &lt;Permission&gt;
    &lt;application&gt;app&lt;/application&gt;
    &lt;feature&gt;f2&lt;/feature&gt;
  &lt;/Permission&gt;
&lt;/PermissionArray&gt;</pre>
</div>
<p>The same value/type combination would result in the following json document:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&quot;application&quot;</span><span class="p">:</span> <span class="s">&quot;app&quot;</span><span class="p">,</span>
        <span class="s">&quot;feature&quot;</span><span class="p">:</span> <span class="s">&quot;f1&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">&quot;application&quot;</span><span class="p">:</span> <span class="s">&quot;app&quot;</span><span class="p">,</span>
        <span class="s">&quot;feature&quot;</span><span class="p">:</span> <span class="s">&quot;f2&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>However, when we serialize the same object to xml using the
<tt class="docutils literal"><span class="pre">Permission.customize(max_occurs=float('inf'))</span></tt> annotation, we get two
separate Xml documents, like so:</p>
<div class="highlight-python"><pre>&lt;Permission&gt;
  &lt;application&gt;app&lt;/application&gt;
  &lt;feature&gt;f1&lt;/feature&gt;
&lt;/Permission&gt;
&lt;Permission&gt;
  &lt;application&gt;app&lt;/application&gt;
  &lt;feature&gt;f2&lt;/feature&gt;
&lt;/Permission&gt;</pre>
</div>
<p>As for Json, we&#8217;d still get the same document. This trick sometimes needed by
XML people for interoperability. Otherwise, you can use whichever version
pleases your eye the most.</p>
<p>You can play with the <tt class="docutils literal"><span class="pre">examples/arrays_simple_vs_complex.py</span></tt> in the source
repository to see the above mechanism at work.</p>
</div>
<div class="section" id="complex-models-as-return-values">
<h3>Complex Models as Return Values<a class="headerlink" href="#complex-models-as-return-values" title="Permalink to this headline">¶</a></h3>
<p>When working with functions, you don&#8217;t need to return instances of the
CompexModel subclasses themselves. Anything that walks and quacks like the
designated return type will work just fine. Specifically, the returned object
should return appropriate values on <tt class="docutils literal"><span class="pre">getattr()</span></tt>s for field names in the
return type. Any exceptions thrown by the object&#8217;s <tt class="docutils literal"><span class="pre">__getattr__</span></tt> method will
be logged and ignored.</p>
<p>However, it is important to return <em>instances</em> and not classes themselves. Due
to the way Spyne serialization works, the classes themselves will also work as
return values until you actually seeing funky responses under load in
production. Don&#8217;t do this! <a class="footnote-reference" href="#id10" id="id5">[5]</a></p>
</div>
</div>
<div class="section" id="fault">
<h2>Fault<a class="headerlink" href="#fault" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../reference/model/fault.html#spyne.model.fault.Fault" title="spyne.model.fault.Fault"><tt class="xref py py-class docutils literal"><span class="pre">spyne.model.fault.Fault</span></tt></a> a special kind of <tt class="docutils literal"><span class="pre">ComplexModel</span></tt> that is
also the subclass of Python&#8217;s own <tt class="xref py py-class docutils literal"><span class="pre">Exception</span></tt>.</p>
<p>When implementing public Spyne services, the recommendation is to raise
instances of <tt class="docutils literal"><span class="pre">Fault</span></tt> subclasses for client errors, and let other exceptions
bubble up until they get logged and re-raised as server-side errors by the
protocol handlers.</p>
<p>Not all protocols and transports care about distinguishing client and server
exceptions. Http has 4xx codes for client-side (invalid request case) errors
and 5xx codes for server-side (legitimate request case) errors. SOAP uses
&#8220;Client.&#8221; and &#8220;Server.&#8221; prefixes in error codes to make this distinction.</p>
<p>To integrate common transport and protocol behavior easily to Spyne, some
common exceptions are defined in the <a class="reference internal" href="../reference/error.html#module-spyne.error" title="spyne.error"><tt class="xref py py-mod docutils literal"><span class="pre">spyne.error</span></tt></a> module. These are
then hardwired to some common Http response codes so that e.g. raising a
<tt class="docutils literal"><span class="pre">ResourceNotFoundError</span></tt> ends up setting the response code to 404.</p>
<p>You can look at the source code of the
<tt class="xref py py-func docutils literal"><span class="pre">spyne.protocol.ProtocolBase.fault_to_http_response_code()</span></tt> to see which
exceptions correspond to which return codes. This can be extended easily by
subclassing your transport and overriding the <tt class="docutils literal"><span class="pre">fault_to_http_response_code</span></tt>
function with your own version.</p>
<p>Note that, while using an Exception sink to re-raise non-Fault based
exceptions as <tt class="docutils literal"><span class="pre">InternalError</span></tt>s is recommended, it&#8217;s not Spyne&#8217;s default
behavior &#8211; you need to subclass the <a class="reference internal" href="../reference/application.html#spyne.application.Application" title="spyne.application.Application"><tt class="xref py py-class docutils literal"><span class="pre">spyne.application.Application</span></tt></a>
and override the <a class="reference internal" href="../reference/application.html#spyne.application.Application.call_wrapper" title="spyne.application.Application.call_wrapper"><tt class="xref py py-func docutils literal"><span class="pre">spyne.application.Application.call_wrapper()</span></tt></a> function
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyApplication</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">call_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">service_class</span><span class="o">.</span><span class="n">call_wrapper</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">Fault</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">service_class</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Client Error: </span><span class="si">%r</span><span class="s"> | Request: </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">,</span>
                                            <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">in_object</span><span class="p">))</span>
            <span class="k">raise</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">service_class</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="what-s-next">
<h2>What&#8217;s next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference internal" href="04_usermanager.html#manual-user-manager"><em>User Manager</em></a> tutorial that will walk you through
defining complex objects and using events.</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>By the way, Spyne does not include types like
<a class="reference external" href="http://www.currency-iso.org/">ISO-4217</a>-compliant
&#8216;currency&#8217; and &#8216;monetary&#8217; types. (See
<a class="reference external" href="http://www.w3.org/TR/2001/WD-xforms-20010608/slice4.html">http://www.w3.org/TR/2001/WD-xforms-20010608/slice4.html</a> for more
information.)  They are actually really easy to
implement. If you&#8217;re looking for a simple way to contribute, this would
be a nice place to start! Patches are welcome!</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Spyne used to have mtom (<a class="reference external" href="http://www.w3.org/Submission/soap11mtom10/">http://www.w3.org/Submission/soap11mtom10/</a>)
support. But as it was not maintained in a long time, it&#8217;s not
currently functional. Patches are welcome!</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Not every browser or http daemon supports huge file uploads due to
issues around 32-bit integers. E.g. Firefox &lt; 18.0 can&#8217;t handle big
files: <a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=215450">https://bugzilla.mozilla.org/show_bug.cgi?id=215450</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>Technically, a simple <tt class="docutils literal"><span class="pre">str</span></tt> instance is also a sequence of <tt class="docutils literal"><span class="pre">str</span></tt>
instances. However, using a <tt class="docutils literal"><span class="pre">str</span></tt> as the value to <tt class="docutils literal"><span class="pre">ctx.out_string</span></tt>
would cause sending data in one-byte chunks, which is very inefficient.
See e.g. how HTTP&#8217;s chunked encoding works.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="http://stackoverflow.com/a/15383191">http://stackoverflow.com/a/15383191</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="04_usermanager.html" title="User Manager"
             >next</a> |</li>
        <li class="right" >
          <a href="02_helloworld.html" title="Hello World"
             >previous</a> |</li>
        <li><a href="../index.html">spyne 2.11.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Spyne Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Spyne Contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>